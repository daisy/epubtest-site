{%- extends 'base/base.njk' -%}
{%- import "components/testing-environment-labels.njk" as testingEnvironmentLabels -%}
{%- set title = "Edit Results" -%}
{%- block content -%}

{# <script type="module" src="/js/data-table.js"></script>
<script type="module">
    import * as helpers from '/js/tables/data-table-helpers.js';
    import * as tableSettings from '/js/tables/edit-results-table-settings.js';
    import { style } from '/js/data-table-style.js';

    let rows = {{answerSet.answers | dump | safe}};
    let headers = [
        {
            title: "Test ID",
            id: "testId"
        },
        {
            title: "Name",
            id: "name"
        },   
        {
            title: "Description",
            id: "description"
        },
        {
            title: "Result",
            id: "result"
        },
        {
            title: "Notes",
            id: "notes"
        }
    ];
    
    let dataTable = document.querySelector("data-table");
    dataTable.bodyCellDisplay = tableSettings.bodyCellDisplay;
    dataTable.css = style;
    dataTable.data = { headers, rows };
    window.addEventListener("resize", () => {
        dataTable.render();
    });
</script> #}
<main>
    <h2>Edit Results: {{displayUtils.getTopicName(answerSet.testBook.topic.id)}}</h2>

    {{ testingEnvironmentLabels.TestingEnvironmentTitle(answerSet.testingEnvironment, 'h3', 'p') }}

    <p><b>Test Book:</b> <a href="/books/{{answerSet.testBook.filename}}">{{answerSet.testBook.title}} (v {{answerSet.testBook.version}})</a></p>

    {# <data-table
        summary="Enter test results"
        mobileMode="boxes"
    >
    </data-table>
    <noscript> #}
    <form method="POST" action="/user/forms/results">
        <h2>Summary</h2>
        <label for="summary">Give a summary of your testing experience:</label>
        <textarea id="summary" rows="10" cols="50" name="summary">{{answerSet.summary}}</textarea>

        <h2>Results</h2>
        <p>Enter individual test results:</p>

        <table class="striped">
            <thead>
                <tr>
                    <td>Test ID</td>
                    <td>Name</td>
                    <td>Description</td>
                    <td>Result</td>
                    <td>Notes</td>
                    {#<td>Status</td>#}
                </tr>
            </thead>
            <tbody>
                {%- for answer in answerSet.answers -%}
                <tr>
                    <td>{{answer.test.testId}}<input type="hidden" value="{{answer.id}}" name="answers[{{answer.id}}][id]"></input></td>
                    <td><label for="answer-{{answer.id}}">{{answer.test.name}}</label></td>
                    <td>{{answer.test.description}}</td>
                    <td>
                        <select id="answer-{{answer.id}}" name="answers[{{answer.id}}][value]">
                            <option value="PASS" {%- if answer.value == 'PASS' -%}selected{%- endif -%}>Pass</option>
                            <option value="FAIL" {%- if answer.value == 'FAIL' -%}selected{%- endif -%}>Fail</option>
                            <option value="NA" {%- if answer.value == 'NA' -%}selected{%- endif -%}>Not applicable</option>
                            <option value="NOANSWER" {%- if answer.value == 'NOANSWER' -%}selected{%- endif -%}>No answer</option>
                        </select>
                    </td>
                    <td>
                        <textarea rows="5" cols="20" name="answers[{{answer.id}}][notes]">{%- if answer.notes != "null" -%}
                        {{answer.notes}}{%- endif -%}</textarea>
                        <input type="checkbox" name="answers[{{answer.id}}][publishNotes]" 
                            {%- if answer.notesArePublic -%}checked{%- endif -%}>
                            Publish Notes
                        </input>
                    </td>
                    {#<td>{%- if answer.flag -%} Needs update {%- endif -%}</td>#}
                </tr>
                {%- endfor -%}
            </tbody>
        </table>

        <input type="hidden" name="answerSetId" value="{{answerSet.id}}"></input>
        <input type="hidden" name="next" value="{{next}}"></input>
        <input type="submit" name="submit" value="Save" id="save"></input>
    </form>
    {# </noscript> #}
</main>

{%- endblock -%}