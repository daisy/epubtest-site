{%- extends 'base/admin-base.njk' -%}
{%- set title = "Admin: User Invitations" -%}
{%- block content -%}

<script type="module" src="/js/data-table.js"></script>
<script type="module">
    import { options } from '/js/tables/admin-invites-table-options.js';
    import * as helpers from '/js/tables/data-table-helpers.js';

    let rows = {{ invitations | dump | safe}};

    let headers = [
        {
            title: "Name",
            id: "name",
            sort: (a, b) => helpers.stringSort(a, b, row => row.user.name),
            sortIs: 'asc'
        },
        {
            title: "Email",
            id: "email",
            sort: (a, b) => helpers.stringSort(a, b, row => row.user.login.email),
            sortIs: 'asc'
        },
        {
            title: "Date invited",
            id: "dateInvited",
            sort: (a, b) => helpers.dateSort(a, b, row => row.dateInvited),
            sortIs: 'desc'
        },
        {
            title: "Action",
            id: "action"
        }
    ];
    if (rows.length) {
        document.querySelector("data-table").options = {
            ...options,
            showTextSearch: true,
            columnSelectorLabel: "Select a column",
            filtersLabel: "Filters",
            defaultSortHeader: 2
        };

        document.querySelector("data-table").data = {
            headers, rows
        };  
    }
    window.addEventListener("resize", () => {
        document.querySelector("data-table").render();
    }); 
</script>
<main>
    <h2>Pending invitations</h2>
    {%- if invitations.length == 0 -%}
    <p>There are not currently any pending invitations.</p>
    {%- else -%}
    <p>These users have been invited but have not yet accepted the invitation. You may re-send invites or cancel them.</p>

    <data-table summary="User account invitations" stylesheet="/css/data-table.css"></data-table>
    <noscript>
    Javascript is required to view table(s) on this page.
    </noscript>
    {%- endif -%}
</main>

{%- endblock -%}

