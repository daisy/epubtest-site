{%- extends 'base/htmleton.njk' -%}
{%- block head -%}
<title>epubtest.org{%- if title -%}: {{ title }}{%- endif -%}</title>
<script src="/js/dayjs.min.js"></script>
{%- endblock -%}
{%- block body -%}

<header>
{# TODO incorporate messages at the server level #}
    {# {%- if message -%}
    <p class="message" role="alert"></p>
    {%- endif -%} #}
    <div class="">
        <h1><a href="/">epubtest.org</a></h1>
        <nav aria-label="Main" class="main switcher">
            <ul>
                <li><a href='/results'>Results</a></li>
                <li><a href='/test-books'>Test Books</a></li>
                <li><a href='/participate'>Participate</a></li>
                <li><a href='/about'>About</a></li>
                {%- if accessLevel == 'public' -%}
                <li><a href='/login'>Login</a></li>
                {%- endif -%}
            </ul>
            {%- if accessLevel != 'public' -%}
            <ul class="user-menu">
                
                {%- if accessLevel == 'admin' -%}
                <li role="none">
                    <a role="menuitem" href="/admin">Admin</a>
                </li>
                {%- endif -%}
                <li role="none">
                    <a role="menuitem" href='/user/dashboard'>Dashboard</a>
                </li>
                <li role="none">
                    <a role="menuitem" href='/user/profile'>Profile</a>
                </li>
                <li role="none">
                    <form role="menuitem" method="POST" action="/forms/logout">
                        <input type="submit" name="submit" value="Logout"/>
                    </form>
                </li>
                
                {#<li>
                    <form method="POST" action="/forms/choose-language">
                        <select id="language" name="language" aria-label="Choose language">
                            <option value="en" {%- if currentLanguage == 'en' -%}selected{%- endif -%}>English</option>
                            {%- if isAdminPage == false or isAdminPage == undefined -%}
                            <option value="fr" {%- if currentLanguage == 'fr' -%}selected{%- endif -%}>Français</option>
                            {%- endif -%}
                        </select>
                        <input aria-label="Save language choice" type="submit" name="submit" value="Set"/>
                    </form>
                </li>#}
            </ul>
            {%- endif -%}
        </nav>
    </div>
</header>

{%- block content -%}
{%- endblock -%}

<footer>
<span>© 2019 <a href="https://daisy.org">DAISY Consortium</a></span>
</footer>

<script type="text/javascript">

    const params = new URLSearchParams(window.location.search);  
    if (params.has("message")) {
        showMessage(params.get("message"));
    }
    function showMessage(messageText) {
        let message = document.createElement("p");
        message.classList.add("message");
        message.setAttribute("role", "alert");
        message.textContent = messageText;
        let parent = document.querySelector("header");
        parent.prepend(message);
    }
  
</script>

{%- endblock -%}
